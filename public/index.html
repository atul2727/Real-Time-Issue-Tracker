<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Issue Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide icons as inline SVGs
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const MessageSquare = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const X = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const Clock = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const CheckCircle = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const GitBranch = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="6" y1="3" x2="6" y2="15"></line>
                <circle cx="18" cy="6" r="3"></circle>
                <circle cx="6" cy="18" r="3"></circle>
                <path d="M18 9a9 9 0 0 1-9 9"></path>
            </svg>
        );

        function IssueTracker() {
            const [issues, setIssues] = useState([]);
            const [connected, setConnected] = useState(false);
            const [showNewIssue, setShowNewIssue] = useState(false);
            const [selectedIssue, setSelectedIssue] = useState(null);
            const [username, setUsername] = useState('');
            const [hasUsername, setHasUsername] = useState(false);
            const wsRef = useRef(null);

            const [newIssue, setNewIssue] = useState({
                title: '',
                description: ''
            });

            const [newComment, setNewComment] = useState('');

            useEffect(() => {
                if (!hasUsername) return;

                const ws = new WebSocket('ws://localhost:3000');
                wsRef.current = ws;

                ws.onopen = () => {
                    console.log('Connected to server');
                    setConnected(true);
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    switch (data.type) {
                        case 'INITIAL_DATA':
                            setIssues(data.data);
                            break;
                        
                        case 'ISSUE_CREATED':
                            setIssues(prev => [...prev, data.data]);
                            break;
                        
                        case 'STATUS_UPDATED':
                            setIssues(prev => prev.map(issue => 
                                issue.id === data.issueId 
                                    ? { ...issue, status: data.status }
                                    : issue
                            ));
                            if (selectedIssue?.id === data.issueId) {
                                setSelectedIssue(prev => ({ ...prev, status: data.status }));
                            }
                            break;
                        
                        case 'COMMENT_ADDED':
                            setIssues(prev => prev.map(issue => 
                                issue.id === data.issueId
                                    ? { ...issue, comments: [...issue.comments, data.comment] }
                                    : issue
                            ));
                            if (selectedIssue?.id === data.issueId) {
                                setSelectedIssue(prev => ({
                                    ...prev,
                                    comments: [...prev.comments, data.comment]
                                }));
                            }
                            break;
                    }
                };

                ws.onclose = () => {
                    console.log('Disconnected from server');
                    setConnected(false);
                };

                return () => ws.close();
            }, [hasUsername, selectedIssue]);

            const handleUsernameSubmit = () => {
                if (username.trim()) {
                    setHasUsername(true);
                }
            };

            const handleCreateIssue = () => {
                if (!newIssue.title.trim() || !newIssue.description.trim()) return;
                
                wsRef.current.send(JSON.stringify({
                    type: 'CREATE_ISSUE',
                    data: {
                        title: newIssue.title,
                        description: newIssue.description,
                        createdBy: username
                    }
                }));

                setNewIssue({ title: '', description: '' });
                setShowNewIssue(false);
            };

            const handleUpdateStatus = (issueId, newStatus) => {
                wsRef.current.send(JSON.stringify({
                    type: 'UPDATE_STATUS',
                    issueId,
                    status: newStatus,
                    user: username
                }));
            };

            const handleAddComment = () => {
                if (!newComment.trim() || !selectedIssue) return;

                wsRef.current.send(JSON.stringify({
                    type: 'ADD_COMMENT',
                    issueId: selectedIssue.id,
                    comment: {
                        user: username,
                        text: newComment
                    }
                }));

                setNewComment('');
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'Open': return 'bg-red-100 text-red-800';
                    case 'In Progress': return 'bg-yellow-100 text-yellow-800';
                    case 'Closed': return 'bg-green-100 text-green-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            const getStatusIcon = (status) => {
                switch (status) {
                    case 'Open': return <AlertCircle />;
                    case 'In Progress': return <Clock />;
                    case 'Closed': return <CheckCircle />;
                    default: return null;
                }
            };

            if (!hasUsername) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Issue Tracker</h1>
                            <p className="text-gray-600 mb-6">Enter your name to get started</p>
                            <input
                                type="text"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleUsernameSubmit()}
                                placeholder="Your name"
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"
                            />
                            <button
                                onClick={handleUsernameSubmit}
                                className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                            >
                                Continue
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800">Issue Tracker</h1>
                                    <p className="text-gray-600 mt-1">Welcome, {username}</p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-2">
                                        <div className={`w-3 h-3 rounded-full ${connected ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                        <span className="text-sm text-gray-600">{connected ? 'Connected' : 'Disconnected'}</span>
                                    </div>
                                    <button
                                        onClick={() => setShowNewIssue(true)}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
                                    >
                                        <Plus />
                                        New Issue
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-md overflow-hidden">
                            <table className="w-full">
                                <thead className="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">ID</th>
                                        <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Title</th>
                                        <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Status</th>
                                        <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Created By</th>
                                        <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Comments</th>
                                        <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {issues.map((issue) => (
                                        <tr key={issue.id} className="hover:bg-gray-50 transition-colors">
                                            <td className="px-6 py-4 text-sm text-gray-900">#{issue.id}</td>
                                            <td className="px-6 py-4">
                                                <div className="text-sm font-medium text-gray-900">{issue.title}</div>
                                                <div className="text-sm text-gray-500 truncate max-w-md">{issue.description}</div>
                                            </td>
                                            <td className="px-6 py-4">
                                                <select
                                                    value={issue.status}
                                                    onChange={(e) => handleUpdateStatus(issue.id, e.target.value)}
                                                    className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(issue.status)}`}
                                                >
                                                    <option value="Open">Open</option>
                                                    <option value="In Progress">In Progress</option>
                                                    <option value="Closed">Closed</option>
                                                </select>
                                            </td>
                                            <td className="px-6 py-4 text-sm text-gray-900">{issue.createdBy}</td>
                                            <td className="px-6 py-4 text-sm text-gray-600">{issue.comments.length}</td>
                                            <td className="px-6 py-4">
                                                <button
                                                    onClick={() => setSelectedIssue(issue)}
                                                    className="text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm font-medium"
                                                >
                                                    <MessageSquare />
                                                    View
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {showNewIssue && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800">Create New Issue</h2>
                                        <button onClick={() => setShowNewIssue(false)} className="text-gray-500 hover:text-gray-700">
                                            <X />
                                        </button>
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Title</label>
                                        <input
                                            type="text"
                                            value={newIssue.title}
                                            onChange={(e) => setNewIssue({ ...newIssue, title: e.target.value })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                        <textarea
                                            value={newIssue.description}
                                            onChange={(e) => setNewIssue({ ...newIssue, description: e.target.value })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent h-32"
                                        />
                                    </div>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={handleCreateIssue}
                                            className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                        >
                                            Create Issue
                                        </button>
                                        <button
                                            onClick={() => setShowNewIssue(false)}
                                            className="flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {selectedIssue && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                                    <div className="sticky top-0 bg-white border-b border-gray-200 p-6">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h2 className="text-2xl font-bold text-gray-800 mb-2">{selectedIssue.title}</h2>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-600">#{selectedIssue.id}</span>
                                                    <span className={`px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1 ${getStatusColor(selectedIssue.status)}`}>
                                                        {getStatusIcon(selectedIssue.status)}
                                                        {selectedIssue.status}
                                                    </span>
                                                    <span className="text-sm text-gray-600">by {selectedIssue.createdBy}</span>
                                                </div>
                                            </div>
                                            <button onClick={() => setSelectedIssue(null)} className="text-gray-500 hover:text-gray-700">
                                                <X />
                                            </button>
                                        </div>
                                    </div>

                                    <div className="p-6">
                                        <div className="mb-6">
                                            <h3 className="text-sm font-semibold text-gray-700 mb-2">Description</h3>
                                            <p className="text-gray-700">{selectedIssue.description}</p>
                                        </div>

                                        <div className="mb-6">
                                            <h3 className="text-sm font-semibold text-gray-700 mb-3">Comments ({selectedIssue.comments.length})</h3>
                                            <div className="space-y-3 mb-4">
                                                {selectedIssue.comments.map((comment, idx) => (
                                                    <div key={idx} className="bg-gray-50 rounded-lg p-4">
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <span className="font-medium text-gray-800">{comment.user}</span>
                                                            <span className="text-sm text-gray-500">
                                                                {new Date(comment.timestamp).toLocaleString()}
                                                            </span>
                                                        </div>
                                                        <p className="text-gray-700">{comment.text}</p>
                                                    </div>
                                                ))}
                                            </div>

                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={newComment}
                                                    onChange={(e) => setNewComment(e.target.value)}
                                                    onKeyPress={(e) => e.key === 'Enter' && handleAddComment()}
                                                    placeholder="Add a comment..."
                                                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                />
                                                <button
                                                    onClick={handleAddComment}
                                                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                                >
                                                    Post
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<IssueTracker />, document.getElementById('root'));
    </script>
</body>
</html>